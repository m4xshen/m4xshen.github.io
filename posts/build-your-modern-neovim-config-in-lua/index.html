<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#faf6f1 lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Build your modern Neovim config in Lua - Max Shen</title><meta name=theme-color><meta name=description content="In this tutorial you&rsquo;ll learn how to build and structure your modern Neovim config in Lua. I&rsquo;ll go through options, mappings, autocmds and plugins."><meta name=author content="Max Shen"><link rel="preload stylesheet" as=style href=https://m4xshen.me/main.min.css><script defer src=https://m4xshen.me/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://m4xshen.me/theme.png><link rel=preload as=image href="https://www.gravatar.com/avatar/ca6d5ab638ebf7849057ff0186f44f46?s=160&amp;d=identicon"><link rel=preload as=image href=https://m4xshen.me/github.svg><link rel=preload as=image href=https://m4xshen.me/rss.svg><link rel=icon href=https://m4xshen.me/favicon.ico><link rel=apple-touch-icon href=https://m4xshen.me/apple-touch-icon.png><meta name=generator content="Hugo 0.111.2"><script async src="https://www.googletagmanager.com/gtag/js?id=G-H19K5X8RCB"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H19K5X8RCB")</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-348126858","auto"),ga("send","pageview"))</script><meta property="og:title" content="Build your modern Neovim config in Lua"><meta property="og:description" content="In this tutorial you&rsquo;ll learn how to build and structure your modern Neovim config in Lua. I&rsquo;ll go through options, mappings, autocmds and plugins."><meta property="og:type" content="article"><meta property="og:url" content="https://m4xshen.me/posts/build-your-modern-neovim-config-in-lua/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-26T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-26T00:00:00+00:00"><meta itemprop=name content="Build your modern Neovim config in Lua"><meta itemprop=description content="In this tutorial you&rsquo;ll learn how to build and structure your modern Neovim config in Lua. I&rsquo;ll go through options, mappings, autocmds and plugins."><meta itemprop=datePublished content="2023-02-26T00:00:00+00:00"><meta itemprop=dateModified content="2023-02-26T00:00:00+00:00"><meta itemprop=wordCount content="905"><meta itemprop=keywords content="Neovim,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Build your modern Neovim config in Lua"><meta name=twitter:description content="In this tutorial you&rsquo;ll learn how to build and structure your modern Neovim config in Lua. I&rsquo;ll go through options, mappings, autocmds and plugins."></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://m4xshen.me>Max Shen</a>
<a class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"></a></div><a class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"></a>
<script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#faf6f1"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/about/>About</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/posts/>Posts</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/projects/>Projects</a></nav><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/m4xshen target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=https://m4xshen.me/index.xml target=_blank></a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"><article><header><h1 class="!my-0 pb-2.5">Build your modern Neovim config in Lua</h1><div class="text-sm opacity-60"><time>Feb 26, 2023</time>
<span class=mx-1>&#183;</span>
<span>5 min read</span></div></header><footer class="mt-8 flex flex-wrap"><a class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-3 py-1 no-underline dark:bg-white/[8%]" href=https://m4xshen.me/tags/neovim>üè∑Ô∏è Neovim</a></footer><section><p>In this tutorial you&rsquo;ll learn how to build and structure your modern Neovim config in Lua. I&rsquo;ll go through options, mappings, autocmds and plugins. You can read along with <a href=https://github.com/m4xshen/dotfiles/tree/main/nvim/nvim>my configuration</a>. To learn more about what each option does, use <code>:h 'option name'</code> in Neovim.</p><h2 id=how-neovim-loads-config>How Neovim loads config</h2><p>Neovim supports using <code>init.lua</code> as the configuration file. This should be placed in your config directory:</p><ul><li>Linux, BSD or macOS: <code>~/.config/nvim</code></li><li>Windows: <code>~/AppData/Local/nvim/</code></li></ul><p>Although you can put all the settings inside <code>init.lua</code>, you probably don&rsquo;t want to because the file will become large and difficult to manage.</p><p>To avoid this, separate files to multiple modules and then load them in the <code>init.lua</code> using <code>require</code>. You can place those modules in the <code>lua/</code> directory in your <code>runtimepath</code> (a list of directories to be searched on startup).</p><p>My Neovim config structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>~/.config/nvim
</span></span><span style=display:flex><span>|-- init.lua
</span></span><span style=display:flex><span>|-- lua/
</span></span><span style=display:flex><span>|  |-- config/
</span></span><span style=display:flex><span>|  |  |-- options.lua
</span></span><span style=display:flex><span>|  |  |-- mappings.lua
</span></span><span style=display:flex><span>|  |  |-- autocmds.lua
</span></span><span style=display:flex><span>|  |  |-- lazy.lua
</span></span><span style=display:flex><span>|  |-- plugins/
</span></span><span style=display:flex><span>|     |-- autoclose.lua
</span></span><span style=display:flex><span>|     |-- lsp.lua
</span></span><span style=display:flex><span>|       :
</span></span></code></pre></div><p>The first line of <code>init.lua</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>require(<span style=color:#e6db74>&#34;config.options&#34;</span>)
</span></span></code></pre></div><p>When Neovim reads this line on startup, it goes through the <code>runtimepath</code>, search for <code>lua/</code> and load <code>/config/options.lua</code>. The default <code>runtimepath</code> includes includes <code>~/.config/nvim</code>. This is why we put the <code>lua/</code> inside it.</p><p>Notes:</p><ul><li><code>.</code> in the module name is treated as a directory separator when searching.</li><li>You don&rsquo;t need to type the <code>.lua</code> extension.</li></ul><p>Now we understand how Neovim finds our files. We can start configuring it! Note that all the directories specified below start from the Neovim config directory.</p><h2 id=options>Options</h2><p>You can set options via Lua in two ways: <code>vim.opt</code> and <code>vim.o</code> series. I recommend using <code>vim.opt</code> series because it is more Lua-style, you can:</p><ul><li>use <code>:append()</code>, <code>:prepend()</code> and <code>:remove()</code> to manipulate options</li><li>set its value to Lua table</li></ul><p>(see the differences between them with <code>:h lua-guide-options</code>)</p><p>You can set options with <code>vim.opt.option-name = value</code>.</p><p>Part of my <a href=https://github.com/m4xshen/dotfiles/blob/main/nvim/nvim/lua/config/options.lua>lua/config/option.lua</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- enable line number and relative line number</span>
</span></span><span style=display:flex><span>vim.opt.number <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>vim.opt.relativenumber <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- use global statusline</span>
</span></span><span style=display:flex><span>vim.opt.laststatus <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- disable mouse</span>
</span></span><span style=display:flex><span>vim.opt.mouse <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><p>Remember to <code>require("config.options")</code> in <code>init.lua</code>.</p><h2 id=keymap>Keymap</h2><p>Define your leader key: (I use space. Change this to whatever you like.)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>vim.g.mapleader <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34; &#34;</span>
</span></span></code></pre></div><p>Add a new mapping:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>vim.keymap.set({mode}, {lhs}, {rhs}, {opts})
</span></span></code></pre></div><ul><li>{mode} (string or table) mode short-name<ul><li>"" for Normal, Visual, Select, Operator-pending mode</li><li>&ldquo;n&rdquo; for Normal mode</li><li>&ldquo;v&rdquo; for Visual and Select mode</li><li>&ldquo;s&rdquo; for Select mode</li><li>&ldquo;x&rdquo; for Visual mode</li><li>&ldquo;o&rdquo; for Operator-pending mode</li><li>&ldquo;i&rdquo; for Insert mode</li><li>&ldquo;t&rdquo; for Terminal mode</li><li>&ldquo;!&rdquo; for Insert Insert and Command-line mode</li></ul></li><li>{lhs}: (string) left-hand side of the mapping, the keys we want to map</li><li>{rhs}: (string or function) right-hand side of the mapping, the keys or function we want to execute after pressing {lhs}</li><li>{opts}: (table) optional parameters<ul><li>silent: define a mapping that will not be echoed on the command line</li><li>noremap: disable recursive mapping</li></ul></li></ul><p>See all available options with <code>:h map-arguments</code>.</p><p>Part of my <a href=https://github.com/m4xshen/dotfiles/blob/main/nvim/nvim/lua/config/mappings.lua>lua/config/mappings.lua</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- map leader+w to save current file in normal mode</span>
</span></span><span style=display:flex><span>vim.keymap.set(<span style=color:#e6db74>&#34;n&#34;</span>, <span style=color:#e6db74>&#34;&lt;Leader&gt;w&#34;</span>, <span style=color:#e6db74>&#34;:write&lt;CR&gt;&#34;</span>, { noremap <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, silent <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- map leader+y to copy to system clipboard in normal and visual mode</span>
</span></span><span style=display:flex><span>vim.keymap.set({ <span style=color:#e6db74>&#34;n&#34;</span>, <span style=color:#e6db74>&#34;v&#34;</span> }, <span style=color:#e6db74>&#34;&lt;Leader&gt;y&#34;</span>, <span style=color:#e6db74>&#39;&#34;+y&#39;</span>, { noremap <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, silent <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> })
</span></span></code></pre></div><p>Remember to <code>require("config.mappings")</code> in <code>init.lua</code>.</p><h2 id=auto-commands>Auto commands</h2><p>Create an autocommand event handler:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>nvim_create_autocmd({event}, {<span style=color:#f92672>*</span>opts})
</span></span></code></pre></div><p>{event}: (string or array) events that will trigger the handler</p><ul><li>BufEnter: after entering a buffer</li><li>CmdlineLeave: before leaving the command-line</li></ul><p>See all available events with <code>:h autocmd-events</code>.</p><p>{opts}: options</p><ul><li>pattern (string or array): pattern to match</li><li>callback (function or string): Lua function called when the event is triggered</li></ul><p>See all available options with <code>:h nvim_create_autocmd</code>.</p><p>Part of my <a href=https://github.com/m4xshen/dotfiles/blob/main/nvim/nvim/lua/config/autocmds.lua>lua/config/autocmds.lua</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- set tab to 3 space when entering a buffer with .lua file</span>
</span></span><span style=display:flex><span>vim.api.nvim_create_autocmd(<span style=color:#e6db74>&#34;BufEnter&#34;</span>, {
</span></span><span style=display:flex><span>   pattern <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;*.lua&#34;</span> },
</span></span><span style=display:flex><span>   callback <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>      vim.opt.shiftwidth <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>      vim.opt.tabstop <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>      vim.opt.softtabstop <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>Remember to <code>require("config.autocmds")</code> in <code>init.lua</code>.</p><h2 id=plugins>Plugins</h2><p>At this point, you should already have a basic Neovim setup. However you can install plugins to make it even better!</p><p>I use <a href=https://github.com/folke/lazy.nvim>lazy.nvim</a> to manage my plugins. We need to install it first. Remember to <code>require("config.lazy")</code> in <code>init.lua</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- `lua/config/lazy.lua`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- install lazy.nvim</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> lazypath <span style=color:#f92672>=</span> vim.fn.stdpath(<span style=color:#e6db74>&#34;data&#34;</span>) <span style=color:#f92672>..</span> <span style=color:#e6db74>&#34;/lazy/lazy.nvim&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> vim.loop.fs_stat(lazypath) <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>   vim.fn.system({
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;git&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;clone&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--filter=blob:none&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;https://github.com/folke/lazy.nvim.git&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--branch=stable&#34;</span>, <span style=color:#75715e>-- latest stable release</span>
</span></span><span style=display:flex><span>      lazypath,
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>vim.opt.rtp:prepend(lazypath)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- load plugins</span>
</span></span><span style=display:flex><span>require(<span style=color:#e6db74>&#34;lazy&#34;</span>).setup(<span style=color:#e6db74>&#34;plugins&#34;</span>)
</span></span></code></pre></div><p>The command on the last line loads all the <code>.lua</code> file under <code>lua/plugins/</code> and the returned table will be merged and passed to <code>setup()</code>.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- lua/plugins/autoclose.lua</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>   {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;m4xshen/autoclose.nvim&#34;</span>,
</span></span><span style=display:flex><span>      opts <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>         options <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            disabled_filetypes <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#e6db74>&#34;markdown&#34;</span> },
</span></span><span style=display:flex><span>            disable_when_touch <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>   },
</span></span><span style=display:flex><span>   { <span style=color:#e6db74>&#34;windwp/nvim-ts-autotag&#34;</span> },
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the returned table, the first line is the plugin&rsquo;s short url and the rest are arguments(optional) to set plugins up:</p><ul><li><code>config</code>: Function that is executed when the plugin loads. The default implementation will run <code>require("plugin").setup(opts)</code>.</li><li><code>opts</code>: Passing options to the <code>config</code> function.</li><li><code>init</code>: Functions that is executed during startup.</li></ul><p>Check out all available option on lazy.nvim&rsquo;s <a href=https://github.com/folke/lazy.nvim#-plugin-spec>README.md</a>.</p><p>Follow this pattern to install and set other plugins up. You can also see my <a href=https://github.com/m4xshen/dotfiles/tree/main/nvim/nvim/lua/plugins>plugins config files</a> to get some ideas.</p><h2 id=final-words>Final Words</h2><p>Now you have a modern Neovim configuration file written in Lua! If you want to explore more, you can install plugins like <a href=https://github.com/nvim-treesitter/nvim-treesitter>nvim-treesitter</a> and <a href=https://github.com/neovim/nvim-lspconfig>nvim-lspconfig</a>. These plugins can give you better experience when coding.</p><p>Discover more plugins on:</p><ul><li><a href=https://github.com/rockerBOO/awesome-neovim>Awesome Neovim</a></li><li><a href=https://this-week-in-neovim.org/>This Week in Neovim</a></li></ul></section><nav class="mt-24 flex rounded-lg bg-black/[3%] p-1.5 text-lg dark:bg-white/[8%]"><a class="ml-auto flex w-1/2 items-center justify-end rounded-md p-6 pl-3 no-underline hover:bg-black/[2%]" href=https://m4xshen.me/posts/vim-command-workflow/><span>Vim Command Workflow</span><span class=ml-1.5>‚Üí</span></a></nav><div class=mt-24 id=disqus_thread></div><script>const disqusShortname="m4xshen",script=document.createElement("script");script.src="https://"+disqusShortname+".disqus.com/embed.js",script.setAttribute("data-timestamp",+new Date),document.head.appendChild(script)</script></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://m4xshen.me>Max Shen</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by HugoÔ∏èÔ∏è</a>Ô∏è</footer></body></html>